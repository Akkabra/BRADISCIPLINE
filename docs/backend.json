{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Bra Discipline application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity (matches Firebase Auth UID)."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name, typically from a social provider like Google."
        },
        "photoURL": {
          "type": "string",
          "description": "The URL of the user's profile picture, typically from a social provider.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "FocusRoutine": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FocusRoutine",
      "type": "object",
      "description": "Represents a user's daily focus routine with three main objectives.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who owns this routine."
        },
        "date": {
          "type": "string",
          "format": "date",
          "description": "The date for this routine in YYYY-MM-DD format."
        },
        "objective1": {
          "type": "string",
          "description": "The first main objective for the day."
        },
        "objective2": {
          "type": "string",
          "description": "The second main objective for the day."
        },
        "objective3": {
          "type": "string",
          "description": "The third main objective for the day."
        },
        "completed1": {
          "type": "boolean",
          "description": "Whether the first objective has been completed."
        },
        "completed2": {
          "type": "boolean",
          "description": "Whether the second objective has been completed."
        },
        "completed3": {
          "type": "boolean",
          "description": "Whether the third objective has been completed."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the routine was created."
        }
      },
      "required": [
        "userId",
        "date",
        "objective1",
        "objective2",
        "objective3",
        "completed1",
        "completed2",
        "completed3",
        "createdAt"
      ]
    },
    "FamilyEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FamilyEvent",
      "type": "object",
      "description": "Represents a planned family connection event.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who owns this event."
        },
        "activity": {
          "type": "string",
          "description": "The name or description of the family activity."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The scheduled date and time for the event."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the event was created."
        }
      },
      "required": [
        "userId",
        "activity",
        "date",
        "createdAt"
      ]
    },
    "ConnectionTask": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ConnectionTask",
      "type": "object",
      "description": "Represents a small, repeatable task to build family connection.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who owns this task."
        },
        "title": {
          "type": "string",
          "description": "The description of the task."
        },
        "completed": {
          "type": "boolean",
          "description": "Whether the task has been completed."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the task was created."
        }
      },
      "required": [
        "userId",
        "title",
        "completed",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data. Path-based ownership: only the user with the matching UID can read/write. All documents in the 'users' collection share the same security requirements.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/daily_routines/{routineId}",
        "definition": {
          "entityName": "DailyRoutine",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores daily routines for each user. Path-based ownership: only the user can read/write their own routines.  No denormalized authorization data is necessary because access is determined by the user ID in the path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "routineId",
              "description": "The unique ID of the routine."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/journals/{journalId}",
        "definition": {
          "entityName": "Journal",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores journal entries for each user. Path-based ownership: only the user can read/write their own journals. No denormalized authorization data is necessary because access is determined by the user ID in the path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "journalId",
              "description": "The unique ID of the journal entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/focus_routines/{focusRoutineId}",
        "definition": {
          "entityName": "FocusRoutine",
          "schema": {
            "$ref": "#/backend/entities/FocusRoutine"
          },
          "description": "Stores the daily focus objectives for each user. Path-based ownership ensures a user can only access their own routines.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "focusRoutineId",
              "description": "The unique ID for the focus routine document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/family_events/{eventId}",
        "definition": {
          "entityName": "FamilyEvent",
          "schema": {
            "$ref": "#/backend/entities/FamilyEvent"
          },
          "description": "Stores planned family connection events for a user. Path-based ownership ensures a user can only access their own events.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "eventId",
              "description": "The unique ID for the family event document."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/connection_tasks/{taskId}",
        "definition": {
          "entityName": "ConnectionTask",
          "schema": {
            "$ref": "#/backend/entities/ConnectionTask"
          },
          "description": "Stores repeatable family connection tasks for a user. Path-based ownership ensures a user can only access their own tasks.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            },
            {
              "name": "taskId",
              "description": "The unique ID for the connection task document."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support user authentication and data storage for the 'Bra Discipline' application. It prioritizes authorization independence and clear access patterns.\n\n*   **/users/{userId}**:  Stores user profiles.  This enables path-based ownership, simplifying security rules (only the authenticated user can access their own profile).\n*   **/users/{userId}/daily_routines/{routineId}**: Stores daily routine data specific to each user. This nested structure maintains the user's ownership and avoids mixing data with different access requirements. This path enables simple path-based ownership. By storing all daily routine data under the user's document, we can easily query and manage this data. Daily routine documents do not contain any user authorization data, as the user ID is implicit in the path.\n*   **/users/{userId}/journals/{journalId}**: Stores journal entries specific to each user. This nested structure maintains the user's ownership, which simplifies security rules.\n*   **/users/{userId}/focus_routines/{focusRoutineId}**: Stores a user's three daily objectives. This is structured as a subcollection to keep user-specific data logically grouped and to leverage path-based security rules for ownership.\n*   **/users/{userId}/family_events/{eventId}**: Stores planned family events. This nested structure ensures user ownership and simplifies security rules.\n*   **/users/{userId}/connection_tasks/{taskId}**: Stores family connection tasks. This subcollection also leverages path-based ownership for secure data access.\n\n\n**Authorization Independence:**\n\nAuthorization independence is achieved through path-based ownership for all user-related data. This eliminates the need for `get()` calls in security rules to determine access, making rules more efficient and robust.\n\n**QAPs (Rules are not Filters):**\n\nThe structure supports secure `list` operations (QAPs) because all documents within a collection share the same security requirements. Listing data under a user's document is secure because the path inherently restricts access to that user's own data. The homogeneous security posture within each collection ensures that rules are not used as filters."
  }
}
    